# セキュアコーディング規定（共通ルール）

## 1. 目的・適用範囲

本規定は、弊社が開発するシステムにおけるセキュリティ対策を強化し、情報漏洩や攻撃のリスクを最小限に抑えることを目的とする。
本規定は、Webシステム（TypeScript, PHP）およびWindowsアプリケーション（C#, VB.NET）を対象とする。

## 2. セキュアコーディングの基本原則

本規定では、以下の基本原則をすべての開発者が遵守することを求める。

### 2.1 入力バリデーションの徹底

- すべての外部からの入力（ユーザー入力、APIリクエスト、ファイルアップロードなど）に対してバリデーションを実施する。
- 入力チェックには、ホワイトリスト方式を推奨する。
- SQLインジェクションやXSSを防ぐため、適切なエスケープ処理を行う。

### 2.2 認証・認可の適切な管理

- パスワードはハッシュ化して保存し、`bcrypt` などの適切なアルゴリズムを使用する。
- セッション管理を適切に行い、`session_regenerate_id(true)` などを活用する。
- 認可チェックを適切に行い、権限がないユーザーによる機能実行を防ぐ。

### 2.3 エラーハンドリングとログ管理

- エラーメッセージにシステム内部情報（SQLクエリ、スタックトレースなど）を含めない。
- ログに機密情報（パスワード、クレジットカード情報など）を記録しない。
- ログ出力時には適切なアクセス制御を設定し、不正な改ざんを防ぐ。

### 2.4 データの暗号化

- 機密データは保存時・通信時に適切な暗号化を行う。
- HTTPS を必須とし、TLS1.2 以上を使用する。
- APIキーやトークンは環境変数または適切なシークレット管理システムで管理する。

### 2.5 依存ライブラリとサードパーティツールの管理

- 使用するライブラリ・フレームワークの公式サポート状況を確認する。
- 定期的に脆弱性スキャンを実施し、脆弱性のあるライブラリを更新する。
- 信頼できないサードパーティコードを使用しない。

## 3. 開発・運用時のセキュリティ対策

### 3.1 コードレビュー時のチェックリスト

- 入力バリデーションが適切に実装されているか
- 認証・認可のチェックが正しく行われているか
- 機密情報が適切に保護されているか
- 外部APIの利用時に適切なエラーハンドリングが行われているか

### 3.2 自動化ツールの活用

- LintツールやSAST（静的解析）ツールを活用し、セキュリティチェックを行う。
- 依存関係の脆弱性を定期的にスキャンする（e.g., `npm audit`, `composer audit`, `dotnet list package --vulnerable`）。
- CI/CD パイプラインにセキュリティチェックを組み込む。

## 4. 違反時の対応

- セキュリティ脆弱性が発覚した場合、速やかに報告し、適切な修正を行う。
- 再発防止策を検討し、必要に応じて規定を更新する。
- 重大な違反があった場合、コードの修正だけでなく開発プロセスの見直しを行う。

## 5. 参考資料

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE (Common Weakness Enumeration)](https://cwe.mitre.org/)
- [NIST Secure Software Development Framework](https://www.nist.gov/)
